(()=>{"use strict";var t={};function e(t,e){const i=t<e,s=t>=e*(e-1),l=t%e==0,n=(t+1)%e==0;return i&&l?"top-left":i&&n?"top-right":s&&l?"bottom-left":s&&n?"bottom-right":i?"top":s?"bottom":l?"left":n?"right":"center"}t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var i=t.g.document;if(!e&&i&&(i.currentScript&&(e=i.currentScript.src),!e)){var s=i.getElementsByTagName("script");s.length&&(e=s[s.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})();class i{constructor(t){this.elemModal=null,this.eventShowModal=null,this.eventHideModal=null,this.hiding=!1,this.destroyed=!1,this.animationSpeed=200,this.options=t||{},this.createModal(),this.elemModal.addEventListener("click",this.handlerCloseModal.bind(this)),this.eventShowModal=new CustomEvent("show.modalFunc",{detail:this.elemModal}),this.eventHideModal=new CustomEvent("hide.modalFunc",{detail:this.elemModal})}createModal(){this.elemModal=document.createElement("div");let t,e="";if(this.elemModal.classList.add("modalFunc"),t='<div class="modal__backdrop" data-dismiss="modalFunc"><div class="modal__content"><div class="modal__header"><div class="modal__title" data-modalFunc="title">{{title}}</div><span class="modal__btn-close" data-dismiss="modalFunc" title="Закрыть">×</span></div><div class="modal__body" data-modalFunc="content">{{content}}</div>{{footer}}</div></div>'.replace("{{title}}",this.options.title||"Новое окно"),t=t.replace("{{content}}",this.options.content||""),this.options.footerButtons){for(const t of this.options.footerButtons){let i='<button type="button" class="{{button_class}}" data-handler={{button_handler}}>{{button_text}}</button>'.replace("{{button_class}}",t.class);i=i.replace("{{button_handler}}",t.handler),i=i.replace("{{button_text}}",t.text),e+=i}e='<div class="modal__footer">{{buttons}}</div>'.replace("{{buttons}}",e)}t=t.replace("{{footer}}",e),this.elemModal.innerHTML=t,document.body.append(this.elemModal)}setupEventListeners(){this.elemModal.removeEventListener("click",this.handlerCloseModal),this.handlerCloseModalBound=this.handlerCloseModal.bind(this),this.elemModal.addEventListener("click",this.handlerCloseModalBound)}show(){this.destroyed||this.hiding||(this.elemModal.classList.add("modal__show"),document.dispatchEvent(this.eventShowModal))}hide(){this.hiding=!0,this.elemModal.classList.remove("modal__show"),this.elemModal.classList.add("modal__hiding"),setTimeout((()=>{this.elemModal.classList.remove("modal__hiding"),this.hiding=!1}),this.animationSpeed),document.dispatchEvent(this.eventHideModal)}handlerCloseModal(t){("modalFunc"===t.target.dataset.dismiss||t.target.dataset.handler)&&this.hide()}destroy(){this.elemModal.parentElement&&this.elemModal.parentElement.removeChild(this.elemModal),this.handlerCloseModalBound&&this.elemModal.removeEventListener("click",this.handlerCloseModalBound),this.destroyed=!0}setContent(t){this.elemModal.querySelector('[data-modalFunc="content"]').innerHTML=t}setTitle(t){this.elemModal.querySelector('[data-modalFunc="title"]').innerHTML=t}}let s=null;function l(t){const e=function(t){const e=t**2;return Array.from({length:e/8},((t,e)=>8*e)).flatMap((t=>[t,t+1]))}(t);let i;do{i=Math.floor(Math.random()*e.length)}while(e[i]===s);return s=e[i],s}const n={pointer:"pointer",notallowed:"not-allowed",hammer:`url('${t.p+"img/hammer_small.png"}'), not-allowed`};class o{constructor(t){this.hitCount=0,this.missCount=0,this.container=t,this.initUI()}initUI(){if(!(this.container instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container.insertAdjacentHTML("afterbegin",`\n    <div class="click-counter">\n        <div>Hit counts: <span class="hit-count">${this.getHitCount()}</span></div>\n        <div>Miss counts: <span class="miss-count">${this.getMissCount()}</span></div>\n    </div>\n    `),this.hitCountEl=this.container.querySelector(".hit-count"),this.missCountEl=this.container.querySelector(".miss-count")}incrementHit(){this.hitCount+=1,this.updateUI()}incrementMiss(){this.missCount+=1,this.updateUI()}updateUI(){this.hitCountEl.textContent=this.getHitCount(),this.missCountEl.textContent=this.getMissCount()}getHitCount(){return this.hitCount}getMissCount(){return this.missCount}reset(){this.missCount=0,this.hitCount=0,this.updateUI()}}class a{constructor(t){this.gamePlay=t,this.indexSelect=null,this.clickCounter=null,this.currentGoblinPosition=null,this.onCellClick=this.onCellClick.bind(this),this.onCellEnter=this.onCellEnter.bind(this),this.onCellLeave=this.onCellLeave.bind(this),this.isGameActive=!0}init(){this.events(),this.gamePlay.drawUi("prairie"),this.clickCounter=new o(document.querySelector("#game-container")),this.gamePlay.onRestart=()=>this.reset(),this.showCharacter()}events(){this.gamePlay.addCellEnterListener(this.onCellEnter),this.gamePlay.addCellLeaveListener(this.onCellLeave),this.gamePlay.addCellClickListener(this.onCellClick)}onCellClick(t){this.reactOnClick(t)}onCellEnter(t){this.gamePlay.setCursor(n.hammer),document.querySelector(".selected-generic")&&this.gamePlay.deselectCell(this.indexSelect),this.gamePlay.selectCell(t),this.indexSelect=t}onCellLeave(t){this.gamePlay.hideCellTooltip(t),this.gamePlay.setCursor(n.pointer)}showCharacter(){this.timerId&&clearInterval(this.timerId),this.timerId=setInterval((()=>{if(!this.isGameActive)return void clearInterval(this.timerId);if(null!==this.currentGoblinPosition&&(this.clickCounter.incrementMiss(),this.clickCounter.getMissCount()>=5))return this.gamePlay.showModalMessage("Вы проиграли!","129335"),this.isGameActive=!1,void clearInterval(this.timerId);const t=l(this.gamePlay.boardSize);this.currentGoblinPosition=t,this.gamePlay.redrawPositions(t)}),1e3),setTimeout((()=>this.resetTimer()),5e5)}resetTimer(){clearInterval(this.timerId)}reactOnClick(t){if(!this.isGameActive)return;if(document.querySelectorAll(".cell")[t].querySelector(".generic")){this.clickCounter.incrementHit(),this.currentGoblinPosition=null,this.resetTimer();const t=l(this.gamePlay.boardSize);this.currentGoblinPosition=t,this.gamePlay.redrawPositions(t),this.showCharacter(),this.clickCounter.getHitCount()>=10&&(this.gamePlay.showModalMessage(`You win! Your points are ${this.clickCounter.getHitCount()}`,"127881"),this.isGameActive=!1,clearInterval(this.timerId))}else this.clickCounter.incrementMiss(),this.clickCounter.getMissCount()>=5&&(this.gamePlay.showModalMessage("You lose!","129335"),this.isGameActive=!1,clearInterval(this.timerId))}reset(){this.isGameActive=!0,this.clickCounter.reset(),this.currentGoblinPosition=null,this.showCharacter()}}console.log("it works!");const r=new class{constructor(t){this.boardSize=t,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.isModal=!0,this.missCounter=0,this.maxMisses=5,this.gameActive=!0,this.initModalListener()}bindToDOM(t){if(!(t instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=t}initModalListener(){document.addEventListener("click",(t=>{"modalHandlerCancel"===t.target.dataset.handler&&this.currentModal&&(this.currentModal.hide(),this.isModal=!1)}))}drawUi(t){this.checkBinding(),this.container.innerHTML='\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(t);for(let t=0;t<this.boardSize**2;t+=1){const i=document.createElement("div");i.classList.add("cell","map-tile",`map-tile-${e(t,this.boardSize)}`),i.addEventListener("mouseenter",(t=>this.onCellEnter(t))),i.addEventListener("mouseleave",(t=>this.onCellLeave(t))),i.addEventListener("click",(t=>this.onCellClick(t))),this.boardEl.append(i)}this.cells=Array.from(this.boardEl.children)}redrawPositions(t){if(this.gameActive){for(const t of this.cells)t.innerHTML="";if(void 0!==t&&t>=0&&t<this.cells.length){const e=this.boardEl.children[t],i=document.createElement("div");i.classList.add("character","generic"),e.append(i)}}}addCellEnterListener(t){this.cellEnterListeners.push(t)}addCellLeaveListener(t){this.cellLeaveListeners.push(t)}addCellClickListener(t){this.cellClickListeners.push(t)}onCellEnter(t){t.preventDefault();const e=this.cells.indexOf(t.currentTarget);this.cellEnterListeners.forEach((t=>t.call(null,e)))}onCellLeave(t){t.preventDefault();const e=this.cells.indexOf(t.currentTarget);this.cellLeaveListeners.forEach((t=>t.call(null,e)))}onCellClick(t){const e=this.cells.indexOf(t.currentTarget);this.cellClickListeners.forEach((t=>t.call(null,e))),this.missCounter=0}selectCell(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yellow";this.deselectCell(t),this.cells[t].classList.add("selected",`selected-${e}`)}deselectCell(t){const e=this.cells[t];e.classList.remove(...Array.from(e.classList).filter((t=>t.startsWith("selected"))))}hideCellTooltip(t){this.cells[t].title=""}setCursor(t){this.boardEl.style.cursor=t}checkBinding(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}showModalMessage(t,e){this.isModal&&(this.isModal=!0,this.gameActive=!1,this.showModal(t,e))}showModal(t,e){const s=new i({title:t,content:`&#${e}`,footerButtons:[{class:"btn btn__cancel",text:"Close",handler:"modalHandlerCancel"},{class:"btn btn__confirm",text:"Новая игра",handler:"modalHandlerConfirm"}]});document.querySelector(".btn__confirm").addEventListener("click",(()=>{s.hide(),window.location.reload()})),this.currentModal=s,s.show()}}(4);r.bindToDOM(document.querySelector("#game-container"));new a(r).init();const c=new a(r);r.onRestart=()=>{c.resetGame()}})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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U0FBU3dELGNBQWMsaUJBQWlCckMsaUJBQWlCLFNBQVMsS0FFaEU2SSxFQUFNbkgsT0FDTmpELE9BQU9HLFNBQVNrSyxRQUFRLElBRzFCeEssS0FBSzhJLGFBQWV5QixFQUVwQkEsRUFBTXJILE1BQ1IsR0QxSzRCLEdBQzlCa0QsRUFBU3lDLFVBQVV0SSxTQUFTd0QsY0FBYyxvQkFFekIsSUFBSW9DLEVBQWVDLEdBQzNCUSxPQUVULE1BQU02RCxFQUFpQixJQUFJdEUsRUFBZUMsR0FDMUNBLEVBQVNXLFVBQVksS0FDbkIwRCxFQUFlQyxXQUFXLEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9haGotZXZlbnRzL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL2Foai1ldmVudHMvLi9zcmMvanMvdXRpbHMvY2FsY1RpbGVUeXBlLmpzIiwid2VicGFjazovL2Foai1ldmVudHMvd2VicGFjay9ydW50aW1lL2dsb2JhbCIsIndlYnBhY2s6Ly9haGotZXZlbnRzL3dlYnBhY2svcnVudGltZS9wdWJsaWNQYXRoIiwid2VicGFjazovL2Foai1ldmVudHMvLi9zcmMvanMvY29tcG9uZW50cy9Nb2RhbC9Nb2RhbC5qcyIsIndlYnBhY2s6Ly9haGotZXZlbnRzLy4vc3JjL2pzL3V0aWxzL2NyZWF0ZVBvc2l0aW9uLmpzIiwid2VicGFjazovL2Foai1ldmVudHMvLi9zcmMvanMvY3Vyc29ycy5qcyIsIndlYnBhY2s6Ly9haGotZXZlbnRzLy4vc3JjL2pzL2NvbXBvbmVudHMvQ2xpY2tDb3VudGVyL0NsaWNrQ291bnRlci5qcyIsIndlYnBhY2s6Ly9haGotZXZlbnRzLy4vc3JjL2pzL2NvbXBvbmVudHMvR2FtZUNvbnRyb2xsZXIvR2FtZUNvbnRyb2xsZXIuanMiLCJ3ZWJwYWNrOi8vYWhqLWV2ZW50cy8uL3NyYy9qcy9hcHAuanMiLCJ3ZWJwYWNrOi8vYWhqLWV2ZW50cy8uL3NyYy9qcy9jb21wb25lbnRzL0dhbWVQbGF5L0dhbWVQbGF5LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFRoZSByZXF1aXJlIHNjb3BlXG52YXIgX193ZWJwYWNrX3JlcXVpcmVfXyA9IHt9O1xuXG4iLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBjYWxjVGlsZVR5cGUoaW5kZXgsIGJvYXJkU2l6ZSkge1xuICBjb25zdCBpc1RvcFJvdyA9IGluZGV4IDwgYm9hcmRTaXplO1xuICBjb25zdCBpc0JvdHRvbVJvdyA9IGluZGV4ID49IGJvYXJkU2l6ZSAqIChib2FyZFNpemUgLSAxKTtcbiAgY29uc3QgaXNMZWZ0Q29sdW1uID0gaW5kZXggJSBib2FyZFNpemUgPT09IDA7XG4gIGNvbnN0IGlzUmlnaHRDb2x1bW4gPSAoaW5kZXggKyAxKSAlIGJvYXJkU2l6ZSA9PT0gMDtcblxuICBpZiAoaXNUb3BSb3cgJiYgaXNMZWZ0Q29sdW1uKSByZXR1cm4gJ3RvcC1sZWZ0JztcbiAgaWYgKGlzVG9wUm93ICYmIGlzUmlnaHRDb2x1bW4pIHJldHVybiAndG9wLXJpZ2h0JztcbiAgaWYgKGlzQm90dG9tUm93ICYmIGlzTGVmdENvbHVtbikgcmV0dXJuICdib3R0b20tbGVmdCc7XG4gIGlmIChpc0JvdHRvbVJvdyAmJiBpc1JpZ2h0Q29sdW1uKSByZXR1cm4gJ2JvdHRvbS1yaWdodCc7XG4gIGlmIChpc1RvcFJvdykgcmV0dXJuICd0b3AnO1xuICBpZiAoaXNCb3R0b21Sb3cpIHJldHVybiAnYm90dG9tJztcbiAgaWYgKGlzTGVmdENvbHVtbikgcmV0dXJuICdsZWZ0JztcbiAgaWYgKGlzUmlnaHRDb2x1bW4pIHJldHVybiAncmlnaHQnO1xuICByZXR1cm4gJ2NlbnRlcic7XG59XG4iLCJfX3dlYnBhY2tfcmVxdWlyZV9fLmcgPSAoZnVuY3Rpb24oKSB7XG5cdGlmICh0eXBlb2YgZ2xvYmFsVGhpcyA9PT0gJ29iamVjdCcpIHJldHVybiBnbG9iYWxUaGlzO1xuXHR0cnkge1xuXHRcdHJldHVybiB0aGlzIHx8IG5ldyBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpO1xuXHR9IGNhdGNoIChlKSB7XG5cdFx0aWYgKHR5cGVvZiB3aW5kb3cgPT09ICdvYmplY3QnKSByZXR1cm4gd2luZG93O1xuXHR9XG59KSgpOyIsInZhciBzY3JpcHRVcmw7XG5pZiAoX193ZWJwYWNrX3JlcXVpcmVfXy5nLmltcG9ydFNjcmlwdHMpIHNjcmlwdFVybCA9IF9fd2VicGFja19yZXF1aXJlX18uZy5sb2NhdGlvbiArIFwiXCI7XG52YXIgZG9jdW1lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fLmcuZG9jdW1lbnQ7XG5pZiAoIXNjcmlwdFVybCAmJiBkb2N1bWVudCkge1xuXHRpZiAoZG9jdW1lbnQuY3VycmVudFNjcmlwdClcblx0XHRzY3JpcHRVcmwgPSBkb2N1bWVudC5jdXJyZW50U2NyaXB0LnNyYztcblx0aWYgKCFzY3JpcHRVcmwpIHtcblx0XHR2YXIgc2NyaXB0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic2NyaXB0XCIpO1xuXHRcdGlmKHNjcmlwdHMubGVuZ3RoKSBzY3JpcHRVcmwgPSBzY3JpcHRzW3NjcmlwdHMubGVuZ3RoIC0gMV0uc3JjXG5cdH1cbn1cbi8vIFdoZW4gc3VwcG9ydGluZyBicm93c2VycyB3aGVyZSBhbiBhdXRvbWF0aWMgcHVibGljUGF0aCBpcyBub3Qgc3VwcG9ydGVkIHlvdSBtdXN0IHNwZWNpZnkgYW4gb3V0cHV0LnB1YmxpY1BhdGggbWFudWFsbHkgdmlhIGNvbmZpZ3VyYXRpb25cbi8vIG9yIHBhc3MgYW4gZW1wdHkgc3RyaW5nIChcIlwiKSBhbmQgc2V0IHRoZSBfX3dlYnBhY2tfcHVibGljX3BhdGhfXyB2YXJpYWJsZSBmcm9tIHlvdXIgY29kZSB0byB1c2UgeW91ciBvd24gbG9naWMuXG5pZiAoIXNjcmlwdFVybCkgdGhyb3cgbmV3IEVycm9yKFwiQXV0b21hdGljIHB1YmxpY1BhdGggaXMgbm90IHN1cHBvcnRlZCBpbiB0aGlzIGJyb3dzZXJcIik7XG5zY3JpcHRVcmwgPSBzY3JpcHRVcmwucmVwbGFjZSgvIy4qJC8sIFwiXCIpLnJlcGxhY2UoL1xcPy4qJC8sIFwiXCIpLnJlcGxhY2UoL1xcL1teXFwvXSskLywgXCIvXCIpO1xuX193ZWJwYWNrX3JlcXVpcmVfXy5wID0gc2NyaXB0VXJsOyIsImltcG9ydCAnLi9tb2RhbC5jc3MnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNb2RhbCB7XG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcbiAgICB0aGlzLmVsZW1Nb2RhbCA9IG51bGw7XG4gICAgdGhpcy5ldmVudFNob3dNb2RhbCA9IG51bGw7XG4gICAgdGhpcy5ldmVudEhpZGVNb2RhbCA9IG51bGw7XG4gICAgdGhpcy5oaWRpbmcgPSBmYWxzZTtcbiAgICB0aGlzLmRlc3Ryb3llZCA9IGZhbHNlO1xuICAgIHRoaXMuYW5pbWF0aW9uU3BlZWQgPSAyMDA7XG5cbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXG4gICAgdGhpcy5jcmVhdGVNb2RhbCgpO1xuICAgIHRoaXMuZWxlbU1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5oYW5kbGVyQ2xvc2VNb2RhbC5iaW5kKHRoaXMpKTtcblxuICAgIHRoaXMuZXZlbnRTaG93TW9kYWwgPSBuZXcgQ3VzdG9tRXZlbnQoJ3Nob3cubW9kYWxGdW5jJywge1xuICAgICAgZGV0YWlsOiB0aGlzLmVsZW1Nb2RhbCxcbiAgICB9KTtcbiAgICB0aGlzLmV2ZW50SGlkZU1vZGFsID0gbmV3IEN1c3RvbUV2ZW50KCdoaWRlLm1vZGFsRnVuYycsIHtcbiAgICAgIGRldGFpbDogdGhpcy5lbGVtTW9kYWwsXG4gICAgfSk7XG4gIH1cblxuICBjcmVhdGVNb2RhbCgpIHtcbiAgICB0aGlzLmVsZW1Nb2RhbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGNvbnN0IG1vZGFsVGVtcGxhdGUgPSAnPGRpdiBjbGFzcz1cIm1vZGFsX19iYWNrZHJvcFwiIGRhdGEtZGlzbWlzcz1cIm1vZGFsRnVuY1wiPjxkaXYgY2xhc3M9XCJtb2RhbF9fY29udGVudFwiPjxkaXYgY2xhc3M9XCJtb2RhbF9faGVhZGVyXCI+PGRpdiBjbGFzcz1cIm1vZGFsX190aXRsZVwiIGRhdGEtbW9kYWxGdW5jPVwidGl0bGVcIj57e3RpdGxlfX08L2Rpdj48c3BhbiBjbGFzcz1cIm1vZGFsX19idG4tY2xvc2VcIiBkYXRhLWRpc21pc3M9XCJtb2RhbEZ1bmNcIiB0aXRsZT1cItCX0LDQutGA0YvRgtGMXCI+w5c8L3NwYW4+PC9kaXY+PGRpdiBjbGFzcz1cIm1vZGFsX19ib2R5XCIgZGF0YS1tb2RhbEZ1bmM9XCJjb250ZW50XCI+e3tjb250ZW50fX08L2Rpdj57e2Zvb3Rlcn19PC9kaXY+PC9kaXY+JztcbiAgICBjb25zdCBtb2RhbEZvb3RlclRlbXBsYXRlID0gJzxkaXYgY2xhc3M9XCJtb2RhbF9fZm9vdGVyXCI+e3tidXR0b25zfX08L2Rpdj4nO1xuICAgIGNvbnN0IG1vZGFsQnV0dG9uVGVtcGxhdGUgPSAnPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJ7e2J1dHRvbl9jbGFzc319XCIgZGF0YS1oYW5kbGVyPXt7YnV0dG9uX2hhbmRsZXJ9fT57e2J1dHRvbl90ZXh0fX08L2J1dHRvbj4nO1xuICAgIGxldCBtb2RhbEhUTUw7XG4gICAgbGV0IG1vZGFsRm9vdGVySFRNTCA9ICcnO1xuXG4gICAgdGhpcy5lbGVtTW9kYWwuY2xhc3NMaXN0LmFkZCgnbW9kYWxGdW5jJyk7XG4gICAgbW9kYWxIVE1MID0gbW9kYWxUZW1wbGF0ZS5yZXBsYWNlKFxuICAgICAgJ3t7dGl0bGV9fScsXG4gICAgICB0aGlzLm9wdGlvbnMudGl0bGUgfHwgJ9Cd0L7QstC+0LUg0L7QutC90L4nLFxuICAgICk7XG4gICAgbW9kYWxIVE1MID0gbW9kYWxIVE1MLnJlcGxhY2UoJ3t7Y29udGVudH19JywgdGhpcy5vcHRpb25zLmNvbnRlbnQgfHwgJycpO1xuICAgIGlmICh0aGlzLm9wdGlvbnMuZm9vdGVyQnV0dG9ucykge1xuICAgICAgZm9yIChjb25zdCBidXR0b24gb2YgdGhpcy5vcHRpb25zLmZvb3RlckJ1dHRvbnMpIHtcbiAgICAgICAgbGV0IG1vZGFsRm9vdGVyQnV0dG9uID0gbW9kYWxCdXR0b25UZW1wbGF0ZS5yZXBsYWNlKFxuICAgICAgICAgICd7e2J1dHRvbl9jbGFzc319JyxcbiAgICAgICAgICBidXR0b24uY2xhc3MsXG4gICAgICAgICk7XG4gICAgICAgIG1vZGFsRm9vdGVyQnV0dG9uID0gbW9kYWxGb290ZXJCdXR0b24ucmVwbGFjZShcbiAgICAgICAgICAne3tidXR0b25faGFuZGxlcn19JyxcbiAgICAgICAgICBidXR0b24uaGFuZGxlcixcbiAgICAgICAgKTtcbiAgICAgICAgbW9kYWxGb290ZXJCdXR0b24gPSBtb2RhbEZvb3RlckJ1dHRvbi5yZXBsYWNlKFxuICAgICAgICAgICd7e2J1dHRvbl90ZXh0fX0nLFxuICAgICAgICAgIGJ1dHRvbi50ZXh0LFxuICAgICAgICApO1xuICAgICAgICBtb2RhbEZvb3RlckhUTUwgKz0gbW9kYWxGb290ZXJCdXR0b247XG4gICAgICB9XG4gICAgICBtb2RhbEZvb3RlckhUTUwgPSBtb2RhbEZvb3RlclRlbXBsYXRlLnJlcGxhY2UoXG4gICAgICAgICd7e2J1dHRvbnN9fScsXG4gICAgICAgIG1vZGFsRm9vdGVySFRNTCxcbiAgICAgICk7XG4gICAgfVxuICAgIG1vZGFsSFRNTCA9IG1vZGFsSFRNTC5yZXBsYWNlKCd7e2Zvb3Rlcn19JywgbW9kYWxGb290ZXJIVE1MKTtcbiAgICB0aGlzLmVsZW1Nb2RhbC5pbm5lckhUTUwgPSBtb2RhbEhUTUw7XG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmQodGhpcy5lbGVtTW9kYWwpO1xuICB9XG5cbiAgc2V0dXBFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLmVsZW1Nb2RhbC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuaGFuZGxlckNsb3NlTW9kYWwpO1xuICAgIHRoaXMuaGFuZGxlckNsb3NlTW9kYWxCb3VuZCA9IHRoaXMuaGFuZGxlckNsb3NlTW9kYWwuYmluZCh0aGlzKTtcbiAgICB0aGlzLmVsZW1Nb2RhbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuaGFuZGxlckNsb3NlTW9kYWxCb3VuZCk7XG4gIH1cblxuICBzaG93KCkge1xuICAgIGlmICghdGhpcy5kZXN0cm95ZWQgJiYgIXRoaXMuaGlkaW5nKSB7XG4gICAgICB0aGlzLmVsZW1Nb2RhbC5jbGFzc0xpc3QuYWRkKCdtb2RhbF9fc2hvdycpO1xuICAgICAgZG9jdW1lbnQuZGlzcGF0Y2hFdmVudCh0aGlzLmV2ZW50U2hvd01vZGFsKTtcbiAgICB9XG4gIH1cblxuICBoaWRlKCkge1xuICAgIHRoaXMuaGlkaW5nID0gdHJ1ZTtcbiAgICB0aGlzLmVsZW1Nb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdtb2RhbF9fc2hvdycpO1xuICAgIHRoaXMuZWxlbU1vZGFsLmNsYXNzTGlzdC5hZGQoJ21vZGFsX19oaWRpbmcnKTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMuZWxlbU1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ21vZGFsX19oaWRpbmcnKTtcbiAgICAgIHRoaXMuaGlkaW5nID0gZmFsc2U7XG4gICAgfSwgdGhpcy5hbmltYXRpb25TcGVlZCk7XG4gICAgZG9jdW1lbnQuZGlzcGF0Y2hFdmVudCh0aGlzLmV2ZW50SGlkZU1vZGFsKTtcbiAgfVxuXG4gIGhhbmRsZXJDbG9zZU1vZGFsKGUpIHtcbiAgICBpZiAoZS50YXJnZXQuZGF0YXNldC5kaXNtaXNzID09PSAnbW9kYWxGdW5jJyB8fCBlLnRhcmdldC5kYXRhc2V0LmhhbmRsZXIpIHtcbiAgICAgIHRoaXMuaGlkZSgpO1xuICAgIH1cbiAgfVxuXG4gIGRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMuZWxlbU1vZGFsLnBhcmVudEVsZW1lbnQpIHtcbiAgICAgIHRoaXMuZWxlbU1vZGFsLnBhcmVudEVsZW1lbnQucmVtb3ZlQ2hpbGQodGhpcy5lbGVtTW9kYWwpO1xuICAgIH1cbiAgICBpZiAodGhpcy5oYW5kbGVyQ2xvc2VNb2RhbEJvdW5kKSB7XG4gICAgICB0aGlzLmVsZW1Nb2RhbC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuaGFuZGxlckNsb3NlTW9kYWxCb3VuZCk7XG4gICAgfVxuICAgIHRoaXMuZGVzdHJveWVkID0gdHJ1ZTtcbiAgfVxuXG4gIHNldENvbnRlbnQoaHRtbCkge1xuICAgIHRoaXMuZWxlbU1vZGFsLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLW1vZGFsRnVuYz1cImNvbnRlbnRcIl0nKS5pbm5lckhUTUwgPSBodG1sO1xuICB9XG5cbiAgc2V0VGl0bGUodGV4dCkge1xuICAgIHRoaXMuZWxlbU1vZGFsLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLW1vZGFsRnVuYz1cInRpdGxlXCJdJykuaW5uZXJIVE1MID0gdGV4dDtcbiAgfVxufVxuIiwibGV0IGxhc3RQb3NpdGlvbiA9IG51bGw7XG5cbmZ1bmN0aW9uIGNyZWF0ZUFycmF5UG9zaXRpb25zKGJvYXJkU2l6ZSkge1xuICBjb25zdCB0b3RhbENlbGxzID0gYm9hcmRTaXplICoqIDI7XG4gIHJldHVybiBBcnJheS5mcm9tKHsgbGVuZ3RoOiB0b3RhbENlbGxzIC8gOCB9LCAoXywgaSkgPT4gaSAqIDgpLmZsYXRNYXAoXG4gICAgKGNlbGwpID0+IFtjZWxsLCBjZWxsICsgMV0sXG4gICk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGNyZWF0ZVBvc2l0aW9uKGJvYXJkU2l6ZSkge1xuICBjb25zdCBjZWxscyA9IGNyZWF0ZUFycmF5UG9zaXRpb25zKGJvYXJkU2l6ZSk7XG4gIGxldCByYW5kO1xuXG4gIGRvIHtcbiAgICByYW5kID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogY2VsbHMubGVuZ3RoKTtcbiAgfSB3aGlsZSAoY2VsbHNbcmFuZF0gPT09IGxhc3RQb3NpdGlvbik7XG5cbiAgbGFzdFBvc2l0aW9uID0gY2VsbHNbcmFuZF07XG4gIHJldHVybiBsYXN0UG9zaXRpb247XG59XG4iLCJpbXBvcnQgaGFtbWVySW1nIGZyb20gJy4uL2ltZy9oYW1tZXJfc21hbGwucG5nJztcblxuY29uc3QgY3Vyc29ycyA9IHtcbiAgcG9pbnRlcjogJ3BvaW50ZXInLFxuICBub3RhbGxvd2VkOiAnbm90LWFsbG93ZWQnLFxuICBoYW1tZXI6IGB1cmwoJyR7aGFtbWVySW1nfScpLCBub3QtYWxsb3dlZGAsXG59O1xuXG5leHBvcnQgZGVmYXVsdCBjdXJzb3JzO1xuIiwiaW1wb3J0ICcuL2NsaWNrLWNvdW50ZXIuY3NzJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2xpY2tDb3VudGVyIHtcbiAgY29uc3RydWN0b3IoY29udGFpbmVyKSB7XG4gICAgdGhpcy5oaXRDb3VudCA9IDA7XG4gICAgdGhpcy5taXNzQ291bnQgPSAwO1xuICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xuXG4gICAgdGhpcy5pbml0VUkoKTtcbiAgfVxuXG4gIGluaXRVSSgpIHtcbiAgICBpZiAoISh0aGlzLmNvbnRhaW5lciBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb250YWluZXIgaXMgbm90IEhUTUxFbGVtZW50Jyk7XG4gICAgfVxuXG4gICAgdGhpcy5jb250YWluZXIuaW5zZXJ0QWRqYWNlbnRIVE1MKFxuICAgICAgJ2FmdGVyYmVnaW4nLFxuICAgICAgYFxuICAgIDxkaXYgY2xhc3M9XCJjbGljay1jb3VudGVyXCI+XG4gICAgICAgIDxkaXY+SGl0IGNvdW50czogPHNwYW4gY2xhc3M9XCJoaXQtY291bnRcIj4ke3RoaXMuZ2V0SGl0Q291bnQoKX08L3NwYW4+PC9kaXY+XG4gICAgICAgIDxkaXY+TWlzcyBjb3VudHM6IDxzcGFuIGNsYXNzPVwibWlzcy1jb3VudFwiPiR7dGhpcy5nZXRNaXNzQ291bnQoKX08L3NwYW4+PC9kaXY+XG4gICAgPC9kaXY+XG4gICAgYCxcbiAgICApO1xuICAgIHRoaXMuaGl0Q291bnRFbCA9IHRoaXMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5oaXQtY291bnQnKTtcbiAgICB0aGlzLm1pc3NDb3VudEVsID0gdGhpcy5jb250YWluZXIucXVlcnlTZWxlY3RvcignLm1pc3MtY291bnQnKTtcbiAgfVxuXG4gIGluY3JlbWVudEhpdCgpIHtcbiAgICB0aGlzLmhpdENvdW50ICs9IDE7XG4gICAgdGhpcy51cGRhdGVVSSgpO1xuICB9XG5cbiAgaW5jcmVtZW50TWlzcygpIHtcbiAgICB0aGlzLm1pc3NDb3VudCArPSAxO1xuICAgIHRoaXMudXBkYXRlVUkoKTtcbiAgfVxuXG4gIHVwZGF0ZVVJKCkge1xuICAgIHRoaXMuaGl0Q291bnRFbC50ZXh0Q29udGVudCA9IHRoaXMuZ2V0SGl0Q291bnQoKTtcbiAgICB0aGlzLm1pc3NDb3VudEVsLnRleHRDb250ZW50ID0gdGhpcy5nZXRNaXNzQ291bnQoKTtcbiAgfVxuXG4gIGdldEhpdENvdW50KCkge1xuICAgIHJldHVybiB0aGlzLmhpdENvdW50O1xuICB9XG5cbiAgZ2V0TWlzc0NvdW50KCkge1xuICAgIHJldHVybiB0aGlzLm1pc3NDb3VudDtcbiAgfVxuXG4gIHJlc2V0KCkge1xuICAgIHRoaXMubWlzc0NvdW50ID0gMDtcbiAgICB0aGlzLmhpdENvdW50ID0gMDtcbiAgICB0aGlzLnVwZGF0ZVVJKCk7XG4gIH1cbn1cbiIsImltcG9ydCBjcmVhdGVQb3NpdGlvbiBmcm9tICcuLi8uLi91dGlscy9jcmVhdGVQb3NpdGlvbic7XG5pbXBvcnQgY3Vyc29ycyBmcm9tICcuLi8uLi9jdXJzb3JzJztcbmltcG9ydCBDbGlja0NvdW50ZXIgZnJvbSAnLi4vQ2xpY2tDb3VudGVyL0NsaWNrQ291bnRlcic7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEdhbWVDb250cm9sbGVyIHtcbiAgY29uc3RydWN0b3IoZ2FtZVBsYXkpIHtcbiAgICB0aGlzLmdhbWVQbGF5ID0gZ2FtZVBsYXk7XG4gICAgdGhpcy5pbmRleFNlbGVjdCA9IG51bGw7XG4gICAgdGhpcy5jbGlja0NvdW50ZXIgPSBudWxsO1xuICAgIHRoaXMuY3VycmVudEdvYmxpblBvc2l0aW9uID0gbnVsbDtcbiAgICB0aGlzLm9uQ2VsbENsaWNrID0gdGhpcy5vbkNlbGxDbGljay5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25DZWxsRW50ZXIgPSB0aGlzLm9uQ2VsbEVudGVyLmJpbmQodGhpcyk7XG4gICAgdGhpcy5vbkNlbGxMZWF2ZSA9IHRoaXMub25DZWxsTGVhdmUuYmluZCh0aGlzKTtcbiAgICB0aGlzLmlzR2FtZUFjdGl2ZSA9IHRydWU7XG4gIH1cblxuICBpbml0KCkge1xuICAgIHRoaXMuZXZlbnRzKCk7XG4gICAgdGhpcy5nYW1lUGxheS5kcmF3VWkoJ3ByYWlyaWUnKTtcbiAgICB0aGlzLmNsaWNrQ291bnRlciA9IG5ldyBDbGlja0NvdW50ZXIoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2dhbWUtY29udGFpbmVyJykpO1xuICAgIHRoaXMuZ2FtZVBsYXkub25SZXN0YXJ0ID0gKCkgPT4gdGhpcy5yZXNldCgpO1xuICAgIHRoaXMuc2hvd0NoYXJhY3RlcigpO1xuICB9XG5cbiAgZXZlbnRzKCkge1xuICAgIHRoaXMuZ2FtZVBsYXkuYWRkQ2VsbEVudGVyTGlzdGVuZXIodGhpcy5vbkNlbGxFbnRlcik7XG4gICAgdGhpcy5nYW1lUGxheS5hZGRDZWxsTGVhdmVMaXN0ZW5lcih0aGlzLm9uQ2VsbExlYXZlKTtcbiAgICB0aGlzLmdhbWVQbGF5LmFkZENlbGxDbGlja0xpc3RlbmVyKHRoaXMub25DZWxsQ2xpY2spO1xuICB9XG5cbiAgb25DZWxsQ2xpY2soZSkge1xuICAgIHRoaXMucmVhY3RPbkNsaWNrKGUpO1xuICB9XG5cbiAgb25DZWxsRW50ZXIoaW5kZXgpIHtcbiAgICB0aGlzLmdhbWVQbGF5LnNldEN1cnNvcihjdXJzb3JzLmhhbW1lcik7XG5cbiAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNlbGVjdGVkLWdlbmVyaWMnKSkge1xuICAgICAgdGhpcy5nYW1lUGxheS5kZXNlbGVjdENlbGwodGhpcy5pbmRleFNlbGVjdCk7XG4gICAgfVxuXG4gICAgdGhpcy5nYW1lUGxheS5zZWxlY3RDZWxsKGluZGV4KTtcbiAgICB0aGlzLmluZGV4U2VsZWN0ID0gaW5kZXg7XG4gIH1cblxuICBvbkNlbGxMZWF2ZShpbmRleCkge1xuICAgIHRoaXMuZ2FtZVBsYXkuaGlkZUNlbGxUb29sdGlwKGluZGV4KTtcbiAgICB0aGlzLmdhbWVQbGF5LnNldEN1cnNvcihjdXJzb3JzLnBvaW50ZXIpO1xuICB9XG5cbiAgc2hvd0NoYXJhY3RlcigpIHtcbiAgICBpZiAodGhpcy50aW1lcklkKSB7XG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLnRpbWVySWQpO1xuICAgIH1cbiAgICB0aGlzLnRpbWVySWQgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICBpZiAoIXRoaXMuaXNHYW1lQWN0aXZlKSB7XG4gICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy50aW1lcklkKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5jdXJyZW50R29ibGluUG9zaXRpb24gIT09IG51bGwpIHtcbiAgICAgICAgdGhpcy5jbGlja0NvdW50ZXIuaW5jcmVtZW50TWlzcygpO1xuICAgICAgICBpZiAodGhpcy5jbGlja0NvdW50ZXIuZ2V0TWlzc0NvdW50KCkgPj0gNSkge1xuICAgICAgICAgIHRoaXMuZ2FtZVBsYXkuc2hvd01vZGFsTWVzc2FnZSgn0JLRiyDQv9GA0L7QuNCz0YDQsNC70LghJywgJzEyOTMzNScpO1xuICAgICAgICAgIHRoaXMuaXNHYW1lQWN0aXZlID0gZmFsc2U7XG4gICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnRpbWVySWQpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb25zdCBwb3NpdGlvbiA9IGNyZWF0ZVBvc2l0aW9uKHRoaXMuZ2FtZVBsYXkuYm9hcmRTaXplKTtcbiAgICAgIHRoaXMuY3VycmVudEdvYmxpblBvc2l0aW9uID0gcG9zaXRpb247XG4gICAgICB0aGlzLmdhbWVQbGF5LnJlZHJhd1Bvc2l0aW9ucyhwb3NpdGlvbik7XG4gICAgfSwgMTAwMCk7XG5cbiAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMucmVzZXRUaW1lcigpLCA1MDAwMDApO1xuICB9XG5cbiAgcmVzZXRUaW1lcigpIHtcbiAgICBjbGVhckludGVydmFsKHRoaXMudGltZXJJZCk7XG4gIH1cblxuICByZWFjdE9uQ2xpY2soZSkge1xuICAgIGlmICghdGhpcy5pc0dhbWVBY3RpdmUpIHJldHVybjtcbiAgICBjb25zdCBib2FyZENlbGxDbGljayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jZWxsJylbZV07XG4gICAgY29uc3QgaXNHb2JsaW4gPSBib2FyZENlbGxDbGljay5xdWVyeVNlbGVjdG9yKCcuZ2VuZXJpYycpO1xuXG4gICAgaWYgKGlzR29ibGluKSB7XG4gICAgICB0aGlzLmNsaWNrQ291bnRlci5pbmNyZW1lbnRIaXQoKTtcbiAgICAgIHRoaXMuY3VycmVudEdvYmxpblBvc2l0aW9uID0gbnVsbDtcbiAgICAgIHRoaXMucmVzZXRUaW1lcigpO1xuICAgICAgY29uc3QgcG9zaXRpb24gPSBjcmVhdGVQb3NpdGlvbih0aGlzLmdhbWVQbGF5LmJvYXJkU2l6ZSk7XG4gICAgICB0aGlzLmN1cnJlbnRHb2JsaW5Qb3NpdGlvbiA9IHBvc2l0aW9uO1xuICAgICAgdGhpcy5nYW1lUGxheS5yZWRyYXdQb3NpdGlvbnMocG9zaXRpb24pO1xuICAgICAgdGhpcy5zaG93Q2hhcmFjdGVyKCk7XG5cbiAgICAgIGlmICh0aGlzLmNsaWNrQ291bnRlci5nZXRIaXRDb3VudCgpID49IDEwKSB7XG4gICAgICAgIHRoaXMuZ2FtZVBsYXkuc2hvd01vZGFsTWVzc2FnZShgWW91IHdpbiEgWW91ciBwb2ludHMgYXJlICR7dGhpcy5jbGlja0NvdW50ZXIuZ2V0SGl0Q291bnQoKX1gLCAnMTI3ODgxJyk7XG4gICAgICAgIHRoaXMuaXNHYW1lQWN0aXZlID0gZmFsc2U7XG4gICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy50aW1lcklkKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jbGlja0NvdW50ZXIuaW5jcmVtZW50TWlzcygpO1xuICAgICAgaWYgKHRoaXMuY2xpY2tDb3VudGVyLmdldE1pc3NDb3VudCgpID49IDUpIHtcbiAgICAgICAgdGhpcy5nYW1lUGxheS5zaG93TW9kYWxNZXNzYWdlKCdZb3UgbG9zZSEnLCAnMTI5MzM1Jyk7XG4gICAgICAgIHRoaXMuaXNHYW1lQWN0aXZlID0gZmFsc2U7XG4gICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy50aW1lcklkKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXNldCgpIHtcbiAgICB0aGlzLmlzR2FtZUFjdGl2ZSA9IHRydWU7XG4gICAgdGhpcy5jbGlja0NvdW50ZXIucmVzZXQoKTtcbiAgICB0aGlzLmN1cnJlbnRHb2JsaW5Qb3NpdGlvbiA9IG51bGw7XG4gICAgLy8gdGhpcy5nYW1lUGxheS5yZXNldEdhbWUoKTtcbiAgICB0aGlzLnNob3dDaGFyYWN0ZXIoKTtcbiAgfVxufVxuIiwiaW1wb3J0IEdhbWVQbGF5IGZyb20gJy4vY29tcG9uZW50cy9HYW1lUGxheS9HYW1lUGxheSc7XG5pbXBvcnQgR2FtZUNvbnRyb2xsZXIgZnJvbSAnLi9jb21wb25lbnRzL0dhbWVDb250cm9sbGVyL0dhbWVDb250cm9sbGVyJztcblxuLyogZXNsaW50LWRpc2FibGUgKi9cbmNvbnNvbGUubG9nKCdpdCB3b3JrcyEnKTtcblxuY29uc3QgZ2FtZVBsYXkgPSBuZXcgR2FtZVBsYXkoNCk7XG5nYW1lUGxheS5iaW5kVG9ET00oZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2dhbWUtY29udGFpbmVyJykpO1xuXG5jb25zdCBnYW1lQ3RybCA9IG5ldyBHYW1lQ29udHJvbGxlcihnYW1lUGxheSk7XG5nYW1lQ3RybC5pbml0KCk7XG5cbmNvbnN0IGdhbWVDb250cm9sbGVyID0gbmV3IEdhbWVDb250cm9sbGVyKGdhbWVQbGF5KTtcbmdhbWVQbGF5Lm9uUmVzdGFydCA9ICgpID0+IHtcbiAgZ2FtZUNvbnRyb2xsZXIucmVzZXRHYW1lKCk7XG59OyIsImltcG9ydCBjYWxjVGlsZVR5cGUgZnJvbSAnLi4vLi4vdXRpbHMvY2FsY1RpbGVUeXBlJztcbmltcG9ydCBNb2RhbCBmcm9tICcuLi9Nb2RhbC9Nb2RhbCc7XG5cbmltcG9ydCAnLi9nYW1lLXBsYXkuY3NzJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR2FtZVBsYXkge1xuICBjb25zdHJ1Y3Rvcihib2FyZFNpemUpIHtcbiAgICB0aGlzLmJvYXJkU2l6ZSA9IGJvYXJkU2l6ZTtcbiAgICB0aGlzLmNvbnRhaW5lciA9IG51bGw7XG4gICAgdGhpcy5ib2FyZEVsID0gbnVsbDtcbiAgICB0aGlzLmNlbGxzID0gW107XG4gICAgdGhpcy5jZWxsQ2xpY2tMaXN0ZW5lcnMgPSBbXTtcbiAgICB0aGlzLmNlbGxFbnRlckxpc3RlbmVycyA9IFtdO1xuICAgIHRoaXMuY2VsbExlYXZlTGlzdGVuZXJzID0gW107XG4gICAgdGhpcy5pc01vZGFsID0gdHJ1ZTtcbiAgICB0aGlzLm1pc3NDb3VudGVyID0gMDtcbiAgICB0aGlzLm1heE1pc3NlcyA9IDU7XG4gICAgdGhpcy5nYW1lQWN0aXZlID0gdHJ1ZTtcblxuICAgIHRoaXMuaW5pdE1vZGFsTGlzdGVuZXIoKTtcbiAgfVxuXG4gIGJpbmRUb0RPTShjb250YWluZXIpIHtcbiAgICBpZiAoIShjb250YWluZXIgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignY29udGFpbmVyIGlzIG5vdCBIVE1MRWxlbWVudCcpO1xuICAgIH1cbiAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgfVxuXG4gIGluaXRNb2RhbExpc3RlbmVyKCkge1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgIGlmIChcbiAgICAgICAgZS50YXJnZXQuZGF0YXNldC5oYW5kbGVyID09PSAnbW9kYWxIYW5kbGVyQ2FuY2VsJ1xuICAgICAgICAmJiB0aGlzLmN1cnJlbnRNb2RhbFxuICAgICAgKSB7XG4gICAgICAgIHRoaXMuY3VycmVudE1vZGFsLmhpZGUoKTtcbiAgICAgICAgdGhpcy5pc01vZGFsID0gZmFsc2U7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBkcmF3VWkodGhlbWUpIHtcbiAgICB0aGlzLmNoZWNrQmluZGluZygpO1xuXG4gICAgdGhpcy5jb250YWluZXIuaW5uZXJIVE1MID0gYFxuICAgICAgPGRpdiBjbGFzcz1cImJvYXJkLWNvbnRhaW5lclwiPlxuICAgICAgICA8ZGl2IGRhdGEtaWQ9XCJib2FyZFwiIGNsYXNzPVwiYm9hcmRcIj48L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIGA7XG5cbiAgICB0aGlzLmJvYXJkRWwgPSB0aGlzLmNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCdbZGF0YS1pZD1ib2FyZF0nKTtcblxuICAgIHRoaXMuYm9hcmRFbC5jbGFzc0xpc3QuYWRkKHRoZW1lKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuYm9hcmRTaXplICoqIDI7IGkgKz0gMSkge1xuICAgICAgY29uc3QgY2VsbEVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICBjZWxsRWwuY2xhc3NMaXN0LmFkZChcbiAgICAgICAgJ2NlbGwnLFxuICAgICAgICAnbWFwLXRpbGUnLFxuICAgICAgICBgbWFwLXRpbGUtJHtjYWxjVGlsZVR5cGUoaSwgdGhpcy5ib2FyZFNpemUpfWAsXG4gICAgICApO1xuICAgICAgY2VsbEVsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZW50ZXInLCAoZXZlbnQpID0+IHRoaXMub25DZWxsRW50ZXIoZXZlbnQpKTtcbiAgICAgIGNlbGxFbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgKGV2ZW50KSA9PiB0aGlzLm9uQ2VsbExlYXZlKGV2ZW50KSk7XG4gICAgICBjZWxsRWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZlbnQpID0+IHRoaXMub25DZWxsQ2xpY2soZXZlbnQpKTtcbiAgICAgIHRoaXMuYm9hcmRFbC5hcHBlbmQoY2VsbEVsKTtcbiAgICB9XG5cbiAgICB0aGlzLmNlbGxzID0gQXJyYXkuZnJvbSh0aGlzLmJvYXJkRWwuY2hpbGRyZW4pO1xuICB9XG5cbiAgcmVkcmF3UG9zaXRpb25zKHBvc2l0aW9uKSB7XG4gICAgaWYgKCF0aGlzLmdhbWVBY3RpdmUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBmb3IgKGNvbnN0IGNlbGwgb2YgdGhpcy5jZWxscykge1xuICAgICAgY2VsbC5pbm5lckhUTUwgPSAnJztcbiAgICB9XG4gICAgaWYgKHBvc2l0aW9uICE9PSB1bmRlZmluZWQgJiYgcG9zaXRpb24gPj0gMCAmJiBwb3NpdGlvbiA8IHRoaXMuY2VsbHMubGVuZ3RoKSB7XG4gICAgICBjb25zdCBjZWxsRWwgPSB0aGlzLmJvYXJkRWwuY2hpbGRyZW5bcG9zaXRpb25dO1xuICAgICAgY29uc3QgY2hhckVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICBjaGFyRWwuY2xhc3NMaXN0LmFkZCgnY2hhcmFjdGVyJywgJ2dlbmVyaWMnKTtcblxuICAgICAgY2VsbEVsLmFwcGVuZChjaGFyRWwpO1xuICAgIH1cbiAgfVxuXG4gIGFkZENlbGxFbnRlckxpc3RlbmVyKGNhbGxiYWNrKSB7XG4gICAgdGhpcy5jZWxsRW50ZXJMaXN0ZW5lcnMucHVzaChjYWxsYmFjayk7XG4gIH1cblxuICBhZGRDZWxsTGVhdmVMaXN0ZW5lcihjYWxsYmFjaykge1xuICAgIHRoaXMuY2VsbExlYXZlTGlzdGVuZXJzLnB1c2goY2FsbGJhY2spO1xuICB9XG5cbiAgYWRkQ2VsbENsaWNrTGlzdGVuZXIoY2FsbGJhY2spIHtcbiAgICB0aGlzLmNlbGxDbGlja0xpc3RlbmVycy5wdXNoKGNhbGxiYWNrKTtcbiAgfVxuXG4gIG9uQ2VsbEVudGVyKGV2ZW50KSB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuY2VsbHMuaW5kZXhPZihldmVudC5jdXJyZW50VGFyZ2V0KTtcbiAgICB0aGlzLmNlbGxFbnRlckxpc3RlbmVycy5mb3JFYWNoKChvKSA9PiBvLmNhbGwobnVsbCwgaW5kZXgpKTtcbiAgfVxuXG4gIG9uQ2VsbExlYXZlKGV2ZW50KSB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuY2VsbHMuaW5kZXhPZihldmVudC5jdXJyZW50VGFyZ2V0KTtcbiAgICB0aGlzLmNlbGxMZWF2ZUxpc3RlbmVycy5mb3JFYWNoKChvKSA9PiBvLmNhbGwobnVsbCwgaW5kZXgpKTtcbiAgfVxuXG4gIG9uQ2VsbENsaWNrKGV2ZW50KSB7XG4gICAgY29uc3QgaW5kZXggPSB0aGlzLmNlbGxzLmluZGV4T2YoZXZlbnQuY3VycmVudFRhcmdldCk7XG4gICAgdGhpcy5jZWxsQ2xpY2tMaXN0ZW5lcnMuZm9yRWFjaCgobykgPT4gby5jYWxsKG51bGwsIGluZGV4KSk7XG4gICAgdGhpcy5taXNzQ291bnRlciA9IDA7XG4gIH1cblxuICBzZWxlY3RDZWxsKGluZGV4LCBjb2xvciA9ICd5ZWxsb3cnKSB7XG4gICAgdGhpcy5kZXNlbGVjdENlbGwoaW5kZXgpO1xuICAgIHRoaXMuY2VsbHNbaW5kZXhdLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJywgYHNlbGVjdGVkLSR7Y29sb3J9YCk7XG4gIH1cblxuICBkZXNlbGVjdENlbGwoaW5kZXgpIHtcbiAgICBjb25zdCBjZWxsID0gdGhpcy5jZWxsc1tpbmRleF07XG4gICAgY2VsbC5jbGFzc0xpc3QucmVtb3ZlKFxuICAgICAgLi4uQXJyYXkuZnJvbShjZWxsLmNsYXNzTGlzdCkuZmlsdGVyKChvKSA9PiBvLnN0YXJ0c1dpdGgoJ3NlbGVjdGVkJykpLFxuICAgICk7XG4gIH1cblxuICBoaWRlQ2VsbFRvb2x0aXAoaW5kZXgpIHtcbiAgICB0aGlzLmNlbGxzW2luZGV4XS50aXRsZSA9ICcnO1xuICB9XG5cbiAgc2V0Q3Vyc29yKGN1cnNvcikge1xuICAgIHRoaXMuYm9hcmRFbC5zdHlsZS5jdXJzb3IgPSBjdXJzb3I7XG4gIH1cblxuICBjaGVja0JpbmRpbmcoKSB7XG4gICAgaWYgKHRoaXMuY29udGFpbmVyID09PSBudWxsKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0dhbWVQbGF5IG5vdCBiaW5kIHRvIERPTScpO1xuICAgIH1cbiAgfVxuXG4gIHNob3dNb2RhbE1lc3NhZ2UobWVzc2FnZSwgdW5pY29kZSkge1xuICAgIGlmICghdGhpcy5pc01vZGFsKSByZXR1cm47XG4gICAgICB0aGlzLmlzTW9kYWwgPSB0cnVlO1xuICAgICAgdGhpcy5nYW1lQWN0aXZlID0gZmFsc2U7XG4gICAgICB0aGlzLnNob3dNb2RhbChtZXNzYWdlLCB1bmljb2RlKTtcbiAgfVxuXG4gIHNob3dNb2RhbChtZXNzYWdlLCB1bmljb2RlKSB7XG4gICAgY29uc3QgbW9kYWwgPSBuZXcgTW9kYWwoe1xuICAgICAgdGl0bGU6IG1lc3NhZ2UsXG4gICAgICBjb250ZW50OiBgJiMke3VuaWNvZGV9YCxcbiAgICAgIGZvb3RlckJ1dHRvbnM6IFtcbiAgICAgICAge1xuICAgICAgICAgIGNsYXNzOiAnYnRuIGJ0bl9fY2FuY2VsJyxcbiAgICAgICAgICB0ZXh0OiAnQ2xvc2UnLFxuICAgICAgICAgIGhhbmRsZXI6ICdtb2RhbEhhbmRsZXJDYW5jZWwnLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgY2xhc3M6ICdidG4gYnRuX19jb25maXJtJyxcbiAgICAgICAgICB0ZXh0OiAn0J3QvtCy0LDRjyDQuNCz0YDQsCcsXG4gICAgICAgICAgaGFuZGxlcjogJ21vZGFsSGFuZGxlckNvbmZpcm0nLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5idG5fX2NvbmZpcm0nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgIC8vIHRoaXMucmVzZXRHYW1lKCk7XG4gICAgICBtb2RhbC5oaWRlKCk7XG4gICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgfSk7XG5cbiAgICB0aGlzLmN1cnJlbnRNb2RhbCA9IG1vZGFsO1xuXG4gICAgbW9kYWwuc2hvdygpO1xuICB9XG5cbiAgLy8gcmVzZXRHYW1lKCkge1xuICAvLyAgIGNvbnNvbGUubG9nKCfQntCaJyk7XG4gIC8vICAgdGhpcy5taXNzQ291bnRlciA9IDA7XG4gIC8vICAgdGhpcy5nYW1lQWN0aXZlID0gdHJ1ZTtcbiAgLy8gICB0aGlzLmlzTW9kYWwgPSBmYWxzZTtcbiAgLy8gICBmb3IgKGNvbnN0IGNlbGwgb2YgdGhpcy5jZWxscykge1xuICAvLyAgICAgY2VsbC5pbm5lckhUTUwgPSAnJztcbiAgLy8gICB9XG5cbiAgLy8gICBpZiAodGhpcy5jdXJyZW50TW9kYWwpIHtcbiAgLy8gICAgIHRoaXMuY3VycmVudE1vZGFsLmhpZGUoKTtcbiAgLy8gICAgIHRoaXMuY3VycmVudE1vZGFsID0gbnVsbDtcbiAgLy8gICB9XG4gIC8vIH1cbn1cbiJdLCJuYW1lcyI6WyJfX3dlYnBhY2tfcmVxdWlyZV9fIiwiY2FsY1RpbGVUeXBlIiwiaW5kZXgiLCJib2FyZFNpemUiLCJpc1RvcFJvdyIsImlzQm90dG9tUm93IiwiaXNMZWZ0Q29sdW1uIiwiaXNSaWdodENvbHVtbiIsImciLCJnbG9iYWxUaGlzIiwidGhpcyIsIkZ1bmN0aW9uIiwiZSIsIndpbmRvdyIsInNjcmlwdFVybCIsImltcG9ydFNjcmlwdHMiLCJsb2NhdGlvbiIsImRvY3VtZW50IiwiY3VycmVudFNjcmlwdCIsInNyYyIsInNjcmlwdHMiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsImxlbmd0aCIsIkVycm9yIiwicmVwbGFjZSIsInAiLCJNb2RhbCIsImNvbnN0cnVjdG9yIiwib3B0aW9ucyIsImVsZW1Nb2RhbCIsImV2ZW50U2hvd01vZGFsIiwiZXZlbnRIaWRlTW9kYWwiLCJoaWRpbmciLCJkZXN0cm95ZWQiLCJhbmltYXRpb25TcGVlZCIsImNyZWF0ZU1vZGFsIiwiYWRkRXZlbnRMaXN0ZW5lciIsImhhbmRsZXJDbG9zZU1vZGFsIiwiYmluZCIsIkN1c3RvbUV2ZW50IiwiZGV0YWlsIiwiY3JlYXRlRWxlbWVudCIsIm1vZGFsSFRNTCIsIm1vZGFsRm9vdGVySFRNTCIsImNsYXNzTGlzdCIsImFkZCIsInRpdGxlIiwiY29udGVudCIsImZvb3RlckJ1dHRvbnMiLCJidXR0b24iLCJtb2RhbEZvb3RlckJ1dHRvbiIsImNsYXNzIiwiaGFuZGxlciIsInRleHQiLCJpbm5lckhUTUwiLCJib2R5IiwiYXBwZW5kIiwic2V0dXBFdmVudExpc3RlbmVycyIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJoYW5kbGVyQ2xvc2VNb2RhbEJvdW5kIiwic2hvdyIsImRpc3BhdGNoRXZlbnQiLCJoaWRlIiwicmVtb3ZlIiwic2V0VGltZW91dCIsInRhcmdldCIsImRhdGFzZXQiLCJkaXNtaXNzIiwiZGVzdHJveSIsInBhcmVudEVsZW1lbnQiLCJyZW1vdmVDaGlsZCIsInNldENvbnRlbnQiLCJodG1sIiwicXVlcnlTZWxlY3RvciIsInNldFRpdGxlIiwibGFzdFBvc2l0aW9uIiwiY3JlYXRlUG9zaXRpb24iLCJjZWxscyIsInRvdGFsQ2VsbHMiLCJBcnJheSIsImZyb20iLCJfIiwiaSIsImZsYXRNYXAiLCJjZWxsIiwiY3JlYXRlQXJyYXlQb3NpdGlvbnMiLCJyYW5kIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwicG9pbnRlciIsIm5vdGFsbG93ZWQiLCJoYW1tZXIiLCJDbGlja0NvdW50ZXIiLCJjb250YWluZXIiLCJoaXRDb3VudCIsIm1pc3NDb3VudCIsImluaXRVSSIsIkhUTUxFbGVtZW50IiwiaW5zZXJ0QWRqYWNlbnRIVE1MIiwiZ2V0SGl0Q291bnQiLCJnZXRNaXNzQ291bnQiLCJoaXRDb3VudEVsIiwibWlzc0NvdW50RWwiLCJpbmNyZW1lbnRIaXQiLCJ1cGRhdGVVSSIsImluY3JlbWVudE1pc3MiLCJ0ZXh0Q29udGVudCIsInJlc2V0IiwiR2FtZUNvbnRyb2xsZXIiLCJnYW1lUGxheSIsImluZGV4U2VsZWN0IiwiY2xpY2tDb3VudGVyIiwiY3VycmVudEdvYmxpblBvc2l0aW9uIiwib25DZWxsQ2xpY2siLCJvbkNlbGxFbnRlciIsIm9uQ2VsbExlYXZlIiwiaXNHYW1lQWN0aXZlIiwiaW5pdCIsImV2ZW50cyIsImRyYXdVaSIsIm9uUmVzdGFydCIsInNob3dDaGFyYWN0ZXIiLCJhZGRDZWxsRW50ZXJMaXN0ZW5lciIsImFkZENlbGxMZWF2ZUxpc3RlbmVyIiwiYWRkQ2VsbENsaWNrTGlzdGVuZXIiLCJyZWFjdE9uQ2xpY2siLCJzZXRDdXJzb3IiLCJjdXJzb3JzIiwiZGVzZWxlY3RDZWxsIiwic2VsZWN0Q2VsbCIsImhpZGVDZWxsVG9vbHRpcCIsInRpbWVySWQiLCJjbGVhckludGVydmFsIiwic2V0SW50ZXJ2YWwiLCJzaG93TW9kYWxNZXNzYWdlIiwicG9zaXRpb24iLCJyZWRyYXdQb3NpdGlvbnMiLCJyZXNldFRpbWVyIiwicXVlcnlTZWxlY3RvckFsbCIsImNvbnNvbGUiLCJsb2ciLCJib2FyZEVsIiwiY2VsbENsaWNrTGlzdGVuZXJzIiwiY2VsbEVudGVyTGlzdGVuZXJzIiwiY2VsbExlYXZlTGlzdGVuZXJzIiwiaXNNb2RhbCIsIm1pc3NDb3VudGVyIiwibWF4TWlzc2VzIiwiZ2FtZUFjdGl2ZSIsImluaXRNb2RhbExpc3RlbmVyIiwiYmluZFRvRE9NIiwiY3VycmVudE1vZGFsIiwidGhlbWUiLCJjaGVja0JpbmRpbmciLCJjZWxsRWwiLCJldmVudCIsImNoaWxkcmVuIiwidW5kZWZpbmVkIiwiY2hhckVsIiwiY2FsbGJhY2siLCJwdXNoIiwicHJldmVudERlZmF1bHQiLCJpbmRleE9mIiwiY3VycmVudFRhcmdldCIsImZvckVhY2giLCJvIiwiY2FsbCIsImNvbG9yIiwiYXJndW1lbnRzIiwiZmlsdGVyIiwic3RhcnRzV2l0aCIsImN1cnNvciIsInN0eWxlIiwibWVzc2FnZSIsInVuaWNvZGUiLCJzaG93TW9kYWwiLCJtb2RhbCIsInJlbG9hZCIsImdhbWVDb250cm9sbGVyIiwicmVzZXRHYW1lIl0sInNvdXJjZVJvb3QiOiIifQ==